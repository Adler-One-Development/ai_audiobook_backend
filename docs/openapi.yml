openapi: 3.0.0
info:
  title: AI Audiobook Backend - Authentication API
  description: |
    Authentication API endpoints for the AI Audiobook application.

    ## Authentication Methods
    - **SupabaseAuth**: Use your Supabase anon key in the `apikey` header
    - **BearerAuth**: Use JWT access token obtained from login/signup
    - **ElevenLabsAuth**: Use ElevenLabs API key in the `eleven-labs-api-key` header

    ## Base URL (QA Environment)
    `https://hskaqvjruqzmgrwxmxxd.supabase.co/functions/v1`
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: https://hskaqvjruqzmgrwxmxxd.supabase.co/functions/v1
    description: QA Environment
  - url: https://oohypifjnozihqzsrrfv.supabase.co/functions/v1
    description: PROD Environment

# Global security - require apikey for all endpoints
# BearerAuth is also available and will be sent if provided in authorize dialog
security:
  - SupabaseAuth: []

components:
  securitySchemes:
    SupabaseAuth:
      type: apiKey
      in: header
      name: apikey
      description: Supabase anonymous API key

    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token from login/signup

    ElevenLabsAuth:
      type: apiKey
      in: header
      name: eleven-labs-api-key
      description: ElevenLabs API key

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: User UUID from Supabase Auth
        fullName:
          type: string
          description: User's full name
        email:
          type: string
          format: email
          description: User's email address
        phone:
          type: string
          nullable: true
          description: User's phone number
        publisherName:
          type: string
          nullable: true
          description: Publisher name
        userType:
          type: string
          enum: [ADMIN, MEMBER, OWNER]
          description: User access level
        role:
          type: string
          nullable: true
          description: User's job title
        industry:
          type: string
          nullable: true
          description: Industry name
        profilePicture:
          type: object
          nullable: true
          properties:
            id:
              type: string
              format: uuid
            url:
              type: string
              format: uri
        is2FAEnabled:
          type: boolean
          description: Whether 2FA is enabled for the user
      required:
        - id
        - fullName
        - email
        - userType

    Genre:
      type: object
      properties:
        id:
          type: string
          format: uuid
        genreName:
          type: string
      required:
        - id
        - genreName

    Comment:
      type: object
      description: A comment on a studio block
      properties:
        id:
          type: string
          format: uuid
          description: Comment ID
        user_id:
          type: string
          format: uuid
          description: ID of the user who created the comment
        user_name:
          type: string
          description: Name of the user who created the comment
        text:
          type: string
          description: Comment text content
        timestamp:
          type: string
          format: date-time
          description: When the comment was created
        block_id:
          type: string
          description: ID of the block this comment is attached to (optional for chapter comments)
        chapter_id:
          type: string
          description: ID of the chapter this comment is attached to (optional for block/word comments)
        quote:
          type: string
          description: Selected text for word-level comments
        range:
          type: object
          properties:
            start:
              type: integer
            end:
              type: integer
          description: Selection range for word-level comments
        resolved:
          type: boolean
          description: Whether the comment has been resolved
      required:
        - id
        - user_id
        - user_name
        - text
        - timestamp
        - resolved

    BookMetadata:
      type: object
      description: Book metadata (title, author, etc.)
      properties:
        title:
          type: string
        author:
          type: string
        description:
          type: string
        isbn:
          type: string
        publisher_name:
          type: string
        publication_date:
          type: string

    Project:
      type: object
      properties:
        id:
          type: string
          format: uuid
        owner_id:
          type: string
          format: uuid
          description: User ID of the project owner
        organization_id:
          type: string
          format: uuid
          description: Organization ID that owns this project
        access_levels:
          type: array
          items:
            type: string
            format: uuid
          description: List of Organization UUIDs that have shared access
        book:
          $ref: "#/components/schemas/BookMetadata"
        gallery:
          $ref: "#/components/schemas/Gallery"
        genre:
          $ref: "#/components/schemas/Genre"
        studio_id:
          type: string
          format: uuid
          nullable: true
        progress:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          default: 0.0
          description: Progress of the audio generation (0.0 to 1.0)
      required:
        - id
        - book

    SuccessResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success]
        message:
          type: string
      required:
        - status
        - message

    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          enum: [error]
        message:
          type: string
        errors:
          type: array
          items:
            type: string
      required:
        - status
        - message

    Chapter:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        content_json:
          type: object
      required:
        - id
        - name

    StudioChapter:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
      required:
        - id
        - name

    GetStudioResponse:
      type: object
      properties:
        book:
          $ref: "#/components/schemas/BookMetadata"
        chapters:
          type: array
          items:
            $ref: "#/components/schemas/StudioChapter"
        gallery_id:
          type: string
          format: uuid
        cast:
          type: array
          items:
            $ref: "#/components/schemas/Comment"
          description: List of cast members (uses same structure as comments for now)
      required:
        - book
        - chapters
        - gallery_id

    ContentBlock:
      type: object
      properties:
        nodes:
          type: array
          items:
            $ref: "#/components/schemas/ContentNode"
        block_id:
          type: string
        sub_type:
          type: string
        comments:
          type: array
          items:
            $ref: "#/components/schemas/Comment"
      required:
        - nodes

    ChapterSummary:
      type: object
      properties:
        title:
          type: string
        chapter_id:
          type: string
        content:
          type: object
          properties:
            blocks:
              type: array
              items:
                $ref: "#/components/schemas/ContentBlock"
      required:
        - title
        - chapter_id
        - content

    GetAllChaptersResponse:
      type: object
      properties:
        chapters:
          type: array
          items:
            $ref: "#/components/schemas/ChapterSummary"
      required:
        - chapters

    ChapterDetails:
      type: object
      properties:
        chapterId:
          type: string
          description: The ID of the chapter (string due to legacy support)
        chapterTitle:
          type: string
        wordCount:
          type: integer
        estimatedCreditsUsed:
          type: number
      required:
        - chapterId
        - chapterTitle
        - wordCount
        - estimatedCreditsUsed

paths:
  /manuscript-processing:
    get:
      summary: Initialize Manuscript Processing (WebSocket)
      description: |
        **WebSocket Endpoint**

        Connect to this endpoint via WebSocket (`wss://`) to process a new audiobook project.

        **Flow:**
        1. Connect to WebSocket.
        2. Send JSON payload with configuration.
        3. Receive status updates and final completion message.

        ### Request Payload (Send as JSON message)
        ```json
        {
            "project_id": "...",
            "supabase_anon_key": "...",
            "eleven_labs_api_key": "...",
            "voice_id": "...",
            "access_token": "YOUR_JWT_TOKEN_HERE"
        }
        ```
      operationId: manuscriptProcessing
      tags:
        - WebSockets
      servers:
        - url: https://manuscript-processing-581621465354.europe-west1.run.app
          description: Cloud Run Service
      responses:
        "101":
          description: Switching Protocols - WebSocket Connection Established
      x-websocket-payload:
        type: object
        required:
          - project_id
          - supabase_anon_key
          - eleven_labs_api_key
          - voice_id
          - access_token
        properties:
          project_id:
            type: string
            format: uuid
            description: The UUID of the project to process.
          supabase_anon_key:
            type: string
            description: Supabase anonymous API key.
          eleven_labs_api_key:
            type: string
            description: ElevenLabs API key.
          voice_id:
            type: string
            description: ElevenLabs Voice ID to use for TTS.
          access_token:
            type: string
            description: User JWT access token.
          open_ai_api_key:
            type: string
            description: OpenAI API key (Required if AI mode is enabled).

  /live-chapter-editor:
    get:
      summary: Live Chapter Editor (WebSocket)
      description: |
        **WebSocket Endpoint**

        Connect to this endpoint via WebSocket (`wss://`) for real-time chapter editing.
        It synchronizes local state with the client and persists changes to ElevenLabs and Supabase.

        **Flow:**
        1. **Connect**: Send initial JSON payload with project details.
        2. **Sync**: Server fetches current content and returns it.
        3. **Edit**: Client sends modified content.
        4. **Update**: Server detects changes and updates backend APIs.

        ### Request Payload (Initial & Updates)
        ```json
        {
            "project_id": "...",
            "chapter_id": "...",
            "supabase_anon_key": "...",
            "eleven_labs_api_key": "...",
            "access_token": "YOUR_JWT_TOKEN_HERE",
            "voice_id": "...",
            "content": "{INIT}" // Send "{INIT}" string to sync. Send Object {...} to update.
        }
        ```
      operationId: liveChapterEditor
      tags:
        - WebSockets
      servers:
        - url: https://chapter-editor-581621465354.us-south1.run.app
          description: Cloud Run Service
      responses:
        "101":
          description: Switching Protocols - WebSocket Connection Established
      x-websocket-payload:
        type: object
        required:
          - project_id
          - chapter_id
          - access_token
        properties:
          project_id:
            type: string
            format: uuid
            description: The UUID of the project.
          chapter_id:
            type: string
            description: The ID of the chapter to edit.
          access_token:
            type: string
            description: User JWT access token.
          content:
            type: object
            description: Chapter content object (blocks) OR string "{INIT}" for initialization.

  /manuscript-update:
    get:
      summary: Update Manuscript Chapters (WebSocket)
      description: |
        **WebSocket Endpoint**

        Connect to this endpoint via WebSocket (`wss://`) to update an existing project with new chapters from a file.

        **Flow:**
        1. Connect to WebSocket.
        2. Send JSON payload with file and studio details.
        3. Server downloads file, extracts chapters, and updates ElevenLabs & Database.

        ### Request Payload (Send as JSON message)
        ```json
        {
            "gallery_id": "0da3b469-2e19-4431-9f75-8ec3e2f0c260",
            "file_id": "ff9f435e-d3f1-4f2e-845c-a4852696612e",
            "studio_id": "XE4Ex5gBhDmqxXXcxNHJ",
            "supabase_anon_key": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
            "eleven_labs_api_key": "sk_...",
            "voice_id": "hpp4J3VqNfWAUOO0d1Us",
            "access_token": "eyJhbGciOiJFUzI1NiIsImtpZCI6IjFmYWY5N2Iy..."
        }
        ```
      operationId: manuscriptUpdate
      tags:
        - WebSockets
      servers:
        - url: https://manuscript-update-581621465354.europe-west1.run.app
          description: Cloud Run Service
      responses:
        "101":
          description: Switching Protocols - WebSocket Connection Established
      x-websocket-payload:
        type: object
        required:
          - gallery_id
          - file_id
          - studio_id
          - supabase_anon_key
          - eleven_labs_api_key
          - voice_id
          - access_token
        properties:
          gallery_id:
            type: string
            format: uuid
            description: Gallery UUID containing the source file.
          file_id:
            type: string
            format: uuid
            description: File UUID within the gallery.
          studio_id:
            type: string
            description: ElevenLabs Studio Project ID.
          supabase_anon_key:
            type: string
            description: Supabase anonymous API key.
          eleven_labs_api_key:
            type: string
            description: ElevenLabs API key.
          voice_id:
            type: string
            description: ElevenLabs Voice ID.
          access_token:
            type: string
            description: User JWT access token (for database permissions).

  /signUp:
    post:
      summary: Register a new user
      description: |
        Creates a new user account with email and password.

        **Default User Type**: All new users are assigned `ADMIN` userType by default.

        **Password Requirements**:
        - Minimum 8 characters
        - At least one uppercase letter (A-Z)
        - At least one lowercase letter (a-z)
        - At least one number (0-9)
        - At least one special character (!@#$%^&*)
      operationId: signUp
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - fullName
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  example: SecurePass123!
                fullName:
                  type: string
                  example: John Doe
      responses:
        "201":
          description: User created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      user:
                        $ref: "#/components/schemas/User"
              example:
                status: success
                message: User created successfully
                user:
                  id: 550e8400-e29b-41d4-a716-446655440000
                  fullName: John Doe
                  email: user@example.com
                  phone: null
                  publisherName: null
                  userType: ADMIN
                  role: null
                  industry: null
                  profilePicture: null
        "400":
          description: Bad request - Invalid input or weak password
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: Password does not meet requirements
                errors:
                  - Password must be at least 8 characters long
                  - Password must contain at least one uppercase letter (A-Z)

  /login:
    post:
      summary: Authenticate user
      description: |
        Authenticates a user with email and password.
        Returns JWT access token, refresh token, and user details.
      operationId: login
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  example: SecurePass123!
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      token:
                        type: string
                        description: JWT access token
                      refreshToken:
                        type: string
                        description: Refresh token for obtaining new access tokens
                      expiresIn:
                        type: integer
                        description: Token expiration time in seconds
                      userType:
                        type: string
                        enum: [ADMIN, MEMBER, OWNER]
                        description: User access level
                      mfaRequired:
                        type: boolean
                        description: Whether User needs to verify MFA
                      user:
                        $ref: "#/components/schemas/User"
              example:
                status: success
                message: Login successful
                token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                refreshToken: xYz123RefreshToken456...
                expiresIn: 3600
                userType: ADMIN
                mfaRequired: false
                user:
                  id: 550e8400-e29b-41d4-a716-446655440000
                  fullName: John Doe
                  email: user@example.com
                  phone: "+1234567890"
                  publisherName: ABC Publishers
                  userType: ADMIN
                  role: Technician
                  industry: Publishing
                  profilePicture:
                    id: 660e8400-e29b-41d4-a716-446655440000
                    url: https://example.com/avatar.jpg
                  is2FAEnabled: false
        "401":
          description: Unauthorized - Invalid credentials
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: Invalid email or password

  /logout:
    post:
      summary: Logout user
      description: |
        Logs out the current user by invalidating their session.

        After logout, the user's JWT token will no longer be valid.
      operationId: logout
      tags:
        - Authentication
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              description: No request body required
      responses:
        "200":
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
              example:
                status: success
                message: Logged out successfully
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: Failed to logout

  /loginWithGoogle:
    post:
      summary: Login with Google OAuth
      description: |
        Initiates Google OAuth login flow and returns the OAuth URL.

        Frontend should redirect user to the returned URL for authentication.
        After successful authentication, user will be redirected back with access tokens.
      operationId: loginWithGoogle
      tags:
        - Authentication
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                redirect_to:
                  type: string
                  description: Supabase auth callback URL
                  default: https://hskaqvjruqzmgrwxmxxd.supabase.co/auth/v1/callback
                return_base_url:
                  type: string
                  description: Base URL where user will be redirected with auth tokens after OAuth completes
                  default: http://localhost:3000
            example:
              redirect_to: "https://hskaqvjruqzmgrwxmxxd.supabase.co/auth/v1/callback"
              return_base_url: "http://localhost:3000"
      responses:
        "200":
          description: OAuth URL generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  url:
                    type: string
                    description: Google OAuth URL to redirect user to
              example:
                status: success
                message: Google OAuth URL generated
                url: "https://accounts.google.com/o/oauth2/v2/auth?..."
        "500":
          description: Failed to generate OAuth URL
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /signUpWithGoogle:
    post:
      summary: Sign up with Google OAuth
      description: |
        Initiates Google OAuth sign up flow and returns the OAuth URL.

        Frontend should redirect user to the returned URL for authentication.
        After successful authentication:
        - User auth account is created
        - Organization is automatically created (user as owner)
        - User record is created with userType ADMIN
        - Full name is extracted from Google profile
      operationId: signUpWithGoogle
      tags:
        - Authentication
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                redirect_to:
                  type: string
                  description: Supabase auth callback URL
                  default: https://hskaqvjruqzmgrwxmxxd.supabase.co/auth/v1/callback
                return_base_url:
                  type: string
                  description: Base URL where user will be redirected with auth tokens after OAuth completes
                  default: http://localhost:3000
            example:
              redirect_to: "https://hskaqvjruqzmgrwxmxxd.supabase.co/auth/v1/callback"
              return_base_url: "http://localhost:3000"
      responses:
        "200":
          description: OAuth URL generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  url:
                    type: string
                    description: Google OAuth URL to redirect user to
              example:
                status: success
                message: Google OAuth URL generated
                url: "https://accounts.google.com/o/oauth2/v2/auth?..."
        "500":
          description: Failed to generate OAuth URL
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /refreshToken:
    post:
      summary: Refresh access token
      description: |
        Obtains a new access token using a valid refresh token.
        Returns new access token and refresh token.

        **Note:** This endpoint uses the refresh token from the request body, not the Authorization header.
      operationId: refreshToken
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  example: xYz123RefreshToken456...
      responses:
        "200":
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      token:
                        type: string
                        description: New JWT access token
                      refreshToken:
                        type: string
                        description: New refresh token
                      expiresIn:
                        type: integer
                        description: Token expiration time in seconds
              example:
                status: success
                message: Token refreshed successfully
                token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                refreshToken: aBc456NewRefreshToken789...
                expiresIn: 3600
        "401":
          description: Unauthorized - Invalid or expired refresh token
          content:
  /confirmPassword:
    post:
      summary: Confirm user password
      description: |
        Verifies if the provided password matches the authenticated user's current password.

        **Requires:** JWT Bearer token in Authorization header

        This endpoint is useful for re-authentication before performing sensitive operations.
      operationId: confirmPassword
      tags:
        - Authentication
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  format: password
                  description: User's current password to verify
            example:
              password: SecurePass123!
      responses:
        "200":
          description: Password confirmed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
              example:
                status: success
                message: Password confirmed successfully
        "400":
          description: Bad request - Password not provided
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: password is required
        "401":
          description: Unauthorized - Incorrect password or invalid token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                incorrectPassword:
                  value:
                    status: error
                    message: Incorrect password
                invalidToken:
                  value:
                    status: error
                    message: Invalid or expired token
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /forgotPassword:
    post:
      summary: Request password reset
      description: |
        Sends a password reset email to the user.
        For security, always returns success regardless of whether the email exists.
      operationId: forgotPassword
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
      responses:
        "200":
          description: Request processed (email sent if account exists)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
              example:
                status: success
                message: If the email exists in our system, a password reset link has been sent

  /resetPassword:
    post:
      summary: Reset password
      description: |
        Resets the user's password using the access token from the password reset email.

        **Note:** The `access_token` in the request body comes from the password reset email link.

        **Password Requirements**:
        - Minimum 8 characters
        - At least one uppercase letter (A-Z)
        - At least one lowercase letter (a-z)
        - At least one number (0-9)
        - At least one special character (!@#$%^&*)
      operationId: resetPassword
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - access_token
                - newPassword
              properties:
                access_token:
                  type: string
                  description: Access token from password reset email
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                newPassword:
                  type: string
                  format: password
                  example: NewSecurePass123!
      responses:
        "200":
          description: Password reset successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
              example:
                status: success
                message: Password has been reset successfully
        "400":
          description: Bad request - Invalid token or weak password
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                weakPassword:
                  value:
                    status: error
                    message: Password does not meet requirements
                    errors:
                      - Password must contain at least one special character (!@#$%^&* etc.)
                expiredToken:
                  value:
                    status: error
                    message: Failed to reset password. The reset link may have expired.

  /setNewPassword:
    post:
      summary: Set new password for newly created user
      description: |
        Sets password and full name for a newly created user using the access token from the account setup email.

        This endpoint is used by new users who receive an invitation email from `/createUser`.
        They use the access token from the email to set their password and provide their full name.

        **Note:** The `access_token` in the request body comes from the reset password email link sent to new users.

        **Password Requirements**:
        - Minimum 8 characters
        - At least one uppercase letter (A-Z)
        - At least one lowercase letter (a-z)
        - At least one number (0-9)
        - At least one special character (!@#$%^&*)
      operationId: setNewPassword
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - access_token
                - full_name
                - newPassword
              properties:
                access_token:
                  type: string
                  description: Access token from account setup/password reset email
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                full_name:
                  type: string
                  description: Full name of the user
                  example: John Doe
                newPassword:
                  type: string
                  format: password
                  description: New password for the account
                  example: NewSecurePass123!
            example:
              access_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
              full_name: John Doe
              newPassword: NewSecurePass123!
      responses:
        "200":
          description: Password and profile name set successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
              example:
                status: success
                message: Password and profile name have been set successfully. You can now log in.
        "400":
          description: Bad request - Invalid token or weak password
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                weakPassword:
                  value:
                    status: error
                    message: Password does not meet requirements
                    errors:
                      - Password must contain at least one special character (!@#$%^&* etc.)
                invalidToken:
                  value:
                    status: error
                    message: Failed to set password in system.
        "401":
          description: Unauthorized - Invalid or expired access token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: Invalid or expired access token. Please request a new password reset link.

  /changePassword:
    post:
      summary: Change user password
      description: |
        Changes the authenticated user's password.

        **Requires:** JWT Bearer token in Authorization header

        **Validations:**
        - Old password must be correct
        - New password must be different from old password
        - New password must meet strength requirements (min 8 chars, uppercase, lowercase, number, special char)
      operationId: changePassword
      tags:
        - Settings Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - old_password
                - new_password
              properties:
                old_password:
                  type: string
                  format: password
                  description: Current password
                new_password:
                  type: string
                  format: password
                  description: New password (must meet strength requirements)
            example:
              old_password: OldPass123!
              new_password: NewSecurePass456!
      responses:
        "200":
          description: Password changed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
              example:
                status: success
                message: Password changed successfully
        "400":
          description: Bad request - Validation failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                samePassword:
                  value:
                    status: error
                    message: New password cannot be the same as old password
                weakPassword:
                  value:
                    status: error
                    message: New password does not meet requirements
                    errors:
                      - Password must contain at least one special character (!@#$%^&* etc.)
        "401":
          description: Unauthorized - Old password incorrect or invalid JWT
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: Old password is incorrect

  /changeEmail:
    post:
      summary: Change user email
      description: |
        Initiates an email change process for the authenticated user.

        **Effects:**
        - Sends a confirmation email to the *new* email address.
        - The user must click the link in the new email to confirm the change.

        **Requires:** JWT Bearer token in Authorization header.
      operationId: changeEmail
      tags:
        - Authentication
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: The new email address
            example:
              email: new-email@example.com
      responses:
        "200":
          description: Confirmation email sent
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
              example:
                status: success
                message: Confirmation link has been sent to your new email address. Please confirm to complete the change.
        "400":
          description: Bad request (Invalid email or already registered)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden - 2FA is enabled
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: Please disable 2FA before changing your email.

  /deactivateAccount:
    post:
      summary: Deactivate account or organization
      description: |
        Deactivates the user's account or entire organization.

        **If organization owner:** Deactivates entire organization and all members.
        **If non-owner:** Deactivates only the caller's account.
      operationId: deactivateAccount
      tags:
        - Authentication
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        "200":
          description: Account/Organization deactivated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /get2FAStatus:
    get:
      summary: Get 2FA status
      description: |
        Retrieves the user's 2FA status.

        **Requires:** JWT Bearer token in Authorization header
      operationId: get2FAStatus
      tags:
        - Multi-Factor Authentication
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        "200":
          description: Status retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  is2FAEnabled:
                    type: boolean
                    description: Whether 2FA is enabled for the user
              example:
                is2FAEnabled: true
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /mfaEnrollStart:
    post:
      summary: Initialize MFA enrollment
      description: |
        Generates a QR code and secret for enrolling a new TOTP factor.
        Returns the SVG QR code and the URI for authenticator apps.

        **Requires:** JWT Bearer token in Authorization header
      operationId: mfaEnrollStart
      tags:
        - Multi-Factor Authentication
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        "200":
          description: Enrollment started successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  type:
                    type: string
                  totp:
                    type: object
                    properties:
                      qr_code:
                        type: string
                      secret:
                        type: string
                      uri:
                        type: string
              example:
                id: 34e62840-7ab1-424a-8472-3c7b39523262
                type: totp
                totp:
                  qr_code: <svg>...</svg>
                  secret: JBSWY3DPEHPK3PXP
                  uri: otpauth://totp/...
        "400":
          description: Enrollment failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /mfaEnrollComplete:
    post:
      summary: Finalize MFA enrollment
      description: |
        Verifies the code from the authenticator app to finalize enrollment.
        Sets `is_2fa_enabled` to true for the user.

        **Requires:** JWT Bearer token in Authorization header
      operationId: mfaEnrollComplete
      tags:
        - Multi-Factor Authentication
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - factorId
                - code
              properties:
                factorId:
                  type: string
                  description: The ID of the factor returned from enrollMFA
                code:
                  type: string
                  description: The 6-digit TOTP code from the app
      responses:
        "200":
          description: Enrollment finalized successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Enrollment finalized successfully
                  access_token:
                    type: string
                  token_type:
                    type: string
                    example: bearer
                  expires_in:
                    type: integer
                  expires_at:
                    type: integer
                  refresh_token:
                    type: string
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      aud:
                        type: string
                      role:
                        type: string
                      email:
                        type: string
                        format: email
                      email_confirmed_at:
                        type: string
                        format: date-time
                      phone:
                        type: string
                      confirmed_at:
                        type: string
                        format: date-time
                      last_sign_in_at:
                        type: string
                        format: date-time
                      app_metadata:
                        type: object
                      user_metadata:
                        type: object
                      factors:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                            created_at:
                              type: string
                            updated_at:
                              type: string
                            status:
                              type: string
                            factor_type:
                              type: string
                            phone:
                              type: string
                            last_challenged_at:
                              type: string
                      identities:
                        type: array
                        items:
                          type: object
                      created_at:
                        type: string
                        format: date-time
                      updated_at:
                        type: string
                        format: date-time
                      is_anonymous:
                        type: boolean
              example:
                status: success
                message: Enrollment finalized successfully
                access_token: eyJhbGciOiJFUzI1NiIsImtpZCI6IjFmYWY5N2IyLTM4NjQtNDQwZi1hNGE1LTQ3MmE2MzI1OTdjMCIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJodHRwczovL2hza2FxdmpydXF6bWdyd3hteHhkLnN1cGFiYXNlLmNvL2F1dGgvdjEiLCJzdWIiOiJmYWIyOTJjYS02ZGI5LTQxZDYtYjY2Zi00ZjVlODczYjkxYzIiLCJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzY4NTAwMTk1LCJpYXQiOjE3Njg0OTY1OTUsImVtYWlsIjoiam9obkBleGFtcGxlLmNvbSIsInBob25lIjoiIiwiYXBwX21ldGFkYXRhIjp7InByb3ZpZGVyIjoiZW1haWwiLCJwcm92aWRlcnMiOlsiZW1haWwiXX0sInVzZXJfbWV0YWRhdGEiOnsiZW1haWwiOiJqb2huQGV4YW1wbGUuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsInBob25lX3ZlcmlmaWVkIjpmYWxzZSwic3ViIjoiZmFiMjkyY2EtNmRiOS00MWQ2LWI2NmYtNGY1ZTg3M2I5MWMyIn0sInJvbGUiOiJhdXRoZW50aWNhdGVkIiwiYWFsIjoiYWFsMiIsImFtciI6W3sibWV0aG9kIjoidG90cCIsInRpbWVzdGFtcCI6MTc2ODQ5NjU5NX0seyJtZXRob2QiOiJwYXNzd29yZCIsInRpbWVzdGFtcCI6MTc2ODQ5MzM2MH1dLCJzZXNzaW9uX2lkIjoiMzU1ZGE3ZGUtMGZmMy00YjZlLThmZDQtOWU3YzM5YTkyZGQ5IiwiaXNfYW5vbnltb3VzIjpmYWxzZX0.eVMcgP3_oltGWOka6Veevdf7Wq0o-dpBwjJiWsNoSFrTqRF6GkCV1VPa3Xxlapp02YwTVp2rilGwGDRsSat7xA
                token_type: bearer
                expires_in: 3600
                expires_at: 1768500195
                refresh_token: vicaiivfstbh
                user:
                  id: fab292ca-6db9-41d6-b66f-4f5e873b91c2
                  aud: authenticated
                  role: authenticated
                  email: john@example.com
                  email_confirmed_at: "2026-01-14T20:31:26.992805Z"
                  phone: ""
                  confirmed_at: "2026-01-14T20:31:26.992805Z"
                  last_sign_in_at: "2026-01-15T16:53:29.59762Z"
                  app_metadata:
                    provider: email
                    providers:
                      - email
                  user_metadata:
                    email: john@example.com
                    email_verified: true
                    phone_verified: false
                    sub: fab292ca-6db9-41d6-b66f-4f5e873b91c2
                  factors:
                    - id: dbec4fb5-e270-45ea-a445-91f95f243107
                      created_at: "2026-01-15T16:35:00.671352Z"
                      updated_at: "2026-01-15T17:03:15.974916Z"
                      status: verified
                      factor_type: totp
                      phone: ""
                      last_challenged_at: "2026-01-15T17:03:15.730207Z"
                  identities:
                    - identity_id: 083d83b7-c519-4c5f-bcd4-33cae86b38b5
                      id: fab292ca-6db9-41d6-b66f-4f5e873b91c2
                      user_id: fab292ca-6db9-41d6-b66f-4f5e873b91c2
                      identity_data:
                        email: john@example.com
                        email_verified: false
                        phone_verified: false
                        sub: fab292ca-6db9-41d6-b66f-4f5e873b91c2
                      provider: email
                      last_sign_in_at: "2026-01-14T20:31:26.990003Z"
                      created_at: "2026-01-14T20:31:26.990058Z"
                      updated_at: "2026-01-14T20:31:26.990058Z"
                      email: john@example.com
                  created_at: "2026-01-14T20:31:26.985955Z"
                  updated_at: "2026-01-15T17:03:15.982763Z"
                  is_anonymous: false
        "400":
          description: Verification failed or invalid input
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /mfaListFactors:
    get:
      summary: List MFA factors
      description: |
        Lists all enrolled MFA factors for the user.

        **Requires:** JWT Bearer token in Authorization header
      operationId: mfaListFactors
      tags:
        - Multi-Factor Authentication
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        "200":
          description: Factors listed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  factors:
                    type: object
                    properties:
                      all:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                            created_at:
                              type: string
                            updated_at:
                              type: string
                            status:
                              type: string
                            factor_type:
                              type: string
                            phone:
                              type: string
                            last_challenged_at:
                              type: string
                      phone:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                            created_at:
                              type: string
                            updated_at:
                              type: string
                            status:
                              type: string
                            factor_type:
                              type: string
                            phone:
                              type: string
                            last_challenged_at:
                              type: string
                      totp:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                            created_at:
                              type: string
                            updated_at:
                              type: string
                            status:
                              type: string
                            factor_type:
                              type: string
                            phone:
                              type: string
                            last_challenged_at:
                              type: string
                      webauthn:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                            created_at:
                              type: string
                            updated_at:
                              type: string
                            status:
                              type: string
                            factor_type:
                              type: string
                            phone:
                              type: string
                            last_challenged_at:
                              type: string
              example:
                status: success
                message: Factors listed successfully
                factors:
                  all:
                    - id: dbec4fb5-e270-45ea-a445-91f95f243107
                      created_at: "2026-01-15T16:35:00.671352Z"
                      updated_at: "2026-01-15T17:03:15.974916Z"
                      status: verified
                      factor_type: totp
                      phone: ""
                      last_challenged_at: "2026-01-15T17:03:15.730207Z"
                  phone: []
                  totp:
                    - id: dbec4fb5-e270-45ea-a445-91f95f243107
                      created_at: "2026-01-15T16:35:00.671352Z"
                      updated_at: "2026-01-15T17:03:15.974916Z"
                      status: verified
                      factor_type: totp
                      phone: ""
                      last_challenged_at: "2026-01-15T17:03:15.730207Z"
                  webauthn: []
        "400":
          description: Error fetching factors
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /mfaUnenroll:
    delete:
      summary: Unenroll MFA factor
      description: |
        Removes a specified MFA factor and updates user status.

        **Requires:** JWT Bearer token in Authorization header
      operationId: mfaUnenroll
      tags:
        - Multi-Factor Authentication
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - factorId
              properties:
                factorId:
                  type: string
      responses:
        "200":
          description: Factor unenrolled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Factor unenrolled successfully
                  id:
                    type: string
              example:
                status: success
                message: Factor unenrolled successfully
                id: 73884067-40dd-4502-817e-8c20e63ee158
        "400":
          description: Error unenrolling factor
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /mfaVerify:
    post:
      summary: Challenge and Verify MFA Factor
      description: Challenges and verifies an MFA factor in a single step using the Supabase challengeAndVerify API.
      tags:
        - Multi-Factor Authentication
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                factorId:
                  type: string
                  description: The ID of the factor to challenge and verify.
                code:
                  type: string
                  description: The code provided by the user.
              required:
                - factorId
                - code
      responses:
        "200":
          description: Successful challenge and verification
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Factor challenged and verified successfully
                  access_token:
                    type: string
                  token_type:
                    type: string
                    example: bearer
                  expires_in:
                    type: integer
                  expires_at:
                    type: integer
                  refresh_token:
                    type: string
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      aud:
                        type: string
                      role:
                        type: string
                      email:
                        type: string
                        format: email
                      email_confirmed_at:
                        type: string
                        format: date-time
                      phone:
                        type: string
                      confirmed_at:
                        type: string
                        format: date-time
                      last_sign_in_at:
                        type: string
                        format: date-time
                      app_metadata:
                        type: object
                      user_metadata:
                        type: object
                      factors:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                            created_at:
                              type: string
                            updated_at:
                              type: string
                            status:
                              type: string
                            factor_type:
                              type: string
                            phone:
                              type: string
                            last_challenged_at:
                              type: string
                      identities:
                        type: array
                        items:
                          type: object
                      created_at:
                        type: string
                        format: date-time
                      updated_at:
                        type: string
                        format: date-time
                      is_anonymous:
                        type: boolean
              example:
                status: success
                message: Factor challenged and verified successfully
                access_token: eyJhbGciOiJFUzI1NiIsImtpZCI6IjFmYWY5N2IyLTM4NjQtNDQwZi1hNGE1LTQ3MmE2MzI1OTdjMCIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJodHRwczovL2hza2FxdmpydXF6bWdyd3hteHhkLnN1cGFiYXNlLmNvL2F1dGgvdjEiLCJzdWIiOiJmYWIyOTJjYS02ZGI5LTQxZDYtYjY2Zi00ZjVlODczYjkxYzIiLCJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzY4NTAwMzA1LCJpYXQiOjE3Njg0OTY3MDUsImVtYWlsIjoiam9obkBleGFtcGxlLmNvbSIsInBob25lIjoiIiwiYXBwX21ldGFkYXRhIjp7InByb3ZpZGVyIjoiZW1haWwiLCJwcm92aWRlcnMiOlsiZW1haWwiXX0sInVzZXJfbWV0YWRhdGEiOnsiZW1haWwiOiJqb2huQGV4YW1wbGUuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsInBob25lX3ZlcmlmaWVkIjpmYWxzZSwic3ViIjoiZmFiMjkyY2EtNmRiOS00MWQ2LWI2NmYtNGY1ZTg3M2I5MWMyIn0sInJvbGUiOiJhdXRoZW50aWNhdGVkIiwiYWFsIjoiYWFsMiIsImFtciI6W3sibWV0aG9kIjoidG90cCIsInRpbWVzdGFtcCI6MTc2ODQ5NjcwNX0seyJtZXRob2QiOiJwYXNzd29yZCIsInRpbWVzdGFtcCI6MTc2ODQ5MzM2MH1dLCJzZXNzaW9uX2lkIjoiMzU1ZGE3ZGUtMGZmMy00YjZlLThmZDQtOWU3YzM5YTkyZGQ5IiwiaXNfYW5vbnltb3VzIjpmYWxzZX0.5GpIsvu22iQY_UsVVUeuZ6jGXpwP5T77eZX_WDft_lTfPSzn1AWKInAykHqNiYNXxehRf_wfrt-EK-NpRhSl0w
                token_type: bearer
                expires_in: 3600
                expires_at: 1768500305
                refresh_token: g5tgvvkdg26r
                user:
                  id: fab292ca-6db9-41d6-b66f-4f5e873b91c2
                  aud: authenticated
                  role: authenticated
                  email: john@example.com
                  email_confirmed_at: "2026-01-14T20:31:26.992805Z"
                  phone: ""
                  confirmed_at: "2026-01-14T20:31:26.992805Z"
                  last_sign_in_at: "2026-01-15T16:53:29.59762Z"
                  app_metadata:
                    provider: email
                    providers:
                      - email
                  user_metadata:
                    email: john@example.com
                    email_verified: true
                    phone_verified: false
                    sub: fab292ca-6db9-41d6-b66f-4f5e873b91c2
                  factors:
                    - id: dbec4fb5-e270-45ea-a445-91f95f243107
                      created_at: "2026-01-15T16:35:00.671352Z"
                      updated_at: "2026-01-15T17:05:04.863916Z"
                      status: verified
                      factor_type: totp
                      phone: ""
                      last_challenged_at: "2026-01-15T17:05:04.862504Z"
                  identities:
                    - identity_id: 083d83b7-c519-4c5f-bcd4-33cae86b38b5
                      id: fab292ca-6db9-41d6-b66f-4f5e873b91c2
                      user_id: fab292ca-6db9-41d6-b66f-4f5e873b91c2
                      identity_data:
                        email: john@example.com
                        email_verified: false
                        phone_verified: false
                        sub: fab292ca-6db9-41d6-b66f-4f5e873b91c2
                      provider: email
                      last_sign_in_at: "2026-01-14T20:31:26.990003Z"
                      created_at: "2026-01-14T20:31:26.990058Z"
                      updated_at: "2026-01-14T20:31:26.990058Z"
                      email: john@example.com
                  created_at: "2026-01-14T20:31:26.985955Z"
                  updated_at: "2026-01-15T17:05:05.130533Z"
                  is_anonymous: false
        "400":
          description: Bad Request
        "401":
          description: Unauthorized
        "500":
          description: Internal Server Error

  /getUserProfile:
    get:
      summary: Get user profile
      description: |
        Retrieves the authenticated user's complete profile including industry and profile picture.

        **Requires:** JWT Bearer token in Authorization header
      operationId: getUserProfile
      tags:
        - Settings Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        "200":
          description: Profile fetched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  profile:
                    type: object
                    properties:
                      full_name:
                        type: string
                      email:
                        type: string
                      phone:
                        type: string
                        nullable: true
                      publisher_name:
                        type: string
                        nullable: true
                      role:
                        type: string
                        nullable: true
                      industry:
                        type: object
                        nullable: true
                        properties:
                          id:
                            type: string
                            format: uuid
                          industry_name:
                            type: string
                      profile_picture:
                        type: object
                        nullable: true
                        properties:
                          id:
                            type: string
                            format: uuid
                          url:
                            type: string
                            format: uri
                      auth_type:
                        type: string
                        description: Authentication provider name (e.g. email, google)
              example:
                status: success
                message: Profile fetched successfully
                profile:
                  full_name: John Doe
                  email: john@example.com
                  phone: "+1234567890"
                  publisher_name: ABC Publishers
                  role: Editor
                  industry:
                    id: 550e8400-e29b-41d4-a716-446655440000
                    industry_name: Academic Publishing
                  auth_type: email
                  profile_picture:
                    id: 660e8400-e29b-41d4-a716-446655440000
                    url: https://example.com/profile.jpg
        "401":
          description: Unauthorized - Missing or invalid JWT token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: User profile not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /updateUserProfile:
    put:
      summary: Update user profile
      description: |
        Updates the authenticated user's profile information.

        **Requires:** JWT Bearer token in Authorization header

        **File Upload:** Supports multipart/form-data for profile picture upload.

        **Note:** If a profile picture is uploaded, any existing profile picture will be deleted from storage.
      operationId: updateUserProfile
      tags:
        - Settings Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                full_name:
                  type: string
                  description: User's full name
                phone:
                  type: string
                  description: Phone number
                publisher_name:
                  type: string
                  description: Publisher name
                role:
                  type: string
                  description: Job title/role
                industry_id:
                  type: string
                  format: uuid
                  description: Industry ID from /getAllIndustries
                profile_picture:
                  type: string
                  format: binary
                  description: Profile picture image file
          application/json:
            schema:
              type: object
              properties:
                full_name:
                  type: string
                phone:
                  type: string
                publisher_name:
                  type: string
                role:
                  type: string
                industry_id:
                  type: string
                  format: uuid
      responses:
        "200":
          description: Profile updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  profile:
                    type: object
                    properties:
                      full_name:
                        type: string
                      email:
                        type: string
                      phone:
                        type: string
                      publisher_name:
                        type: string
                      role:
                        type: string
                      industry:
                        type: object
                        nullable: true
                      profile_picture:
                        type: object
                        nullable: true
              example:
                status: success
                message: Profile updated successfully
                profile:
                  full_name: John Doe
                  email: john@example.com
                  phone: "+1234567890"
                  publisher_name: ABC Publishers
                  role: Senior Editor
                  industry:
                    id: 550e8400-e29b-41d4-a716-446655440000
                    industry_name: Academic Publishing
                  profile_picture:
                    id: 660e8400-e29b-41d4-a716-446655440000
                    url: https://example.com/new-profile.jpg
        "401":
          description: Unauthorized - Missing or invalid JWT token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /removeProfilePicture:
    post:
      summary: Remove Profile Picture
      operationId: removeProfilePicture
      tags:
        - Settings Management
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - profile_picture_id
              properties:
                profile_picture_id:
                  type: string
                  format: uuid
                  description: The ID of the profile picture to remove
      responses:
        "200":
          description: Profile picture removed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Profile picture removed successfully
        "400":
          description: Bad Request
        "401":
          description: Unauthorized
        "403":
          description: Forbidden - Not owner or admin
        "404":
          description: Profile picture not found
        "500":
          description: Internal Server Error

  /createUser:
    post:
      summary: Create users in organization
      description: |
        Creates one or more new users and adds them to the requesting user's organization.

        **Requires:** JWT Bearer token in Authorization header

        **Authorization Rules:**
        - Only ADMIN and OWNER can create users
        - New users are added to the same organization as the creating user
        - Password reset email is sent to each new user to set their password and full name

        **Note:** Users will set their full name when they first set their password via the `/setNewPassword` endpoint.
      operationId: createUser
      tags:
        - Settings Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - emails
                - role
              properties:
                emails:
                  type: array
                  items:
                    type: string
                    format: email
                  description: Array of email addresses for the new users
                  minItems: 1
                role:
                  type: string
                  enum: [ADMIN, OWNER, MEMBER]
                  description: Role for all new users
            example:
              emails:
                - newuser@example.com
                - newuser2@example.com
              role: MEMBER
      responses:
        "201":
          description: Users created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  users:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        email:
                          type: string
                        userType:
                          type: string
                        organizationId:
                          type: string
                          format: uuid
                  failed:
                    type: array
                    items:
                      type: object
                      properties:
                        email:
                          type: string
                        reason:
                          type: string
                    description: List of failed user creations (only present if there are failures)
              example:
                status: success
                message: "2 user(s) created successfully. 0 failed."
                users:
                  - id: 550e8400-e29b-41d4-a716-446655440000
                    email: newuser@example.com
                    userType: MEMBER
                    organizationId: 660e8400-e29b-41d4-a716-446655440001
                  - id: 550e8400-e29b-41d4-a716-446655440002
                    email: newuser2@example.com
                    userType: MEMBER
                    organizationId: 660e8400-e29b-41d4-a716-446655440001
        "400":
          description: Bad request - Invalid input
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: Only ADMIN and OWNER can create users

  /changeUserType:
    post:
      summary: Change user type/role
      description: |
        Changes the userType (role) of a user in the organization.

        **Requires:** JWT Bearer token in Authorization header

        **Authorization Rules:**
        - Members cannot change anyone's userType
        - Owners cannot change Admin userTypes
        - Organization owner cannot change their own userType
        - Can only change userType for users in the same organization
      operationId: changeUserType
      tags:
        - Settings Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
                - userType
              properties:
                id:
                  type: string
                  format: uuid
                  description: ID of the user whose type to change
                userType:
                  type: string
                  enum: [ADMIN, MEMBER, OWNER]
                  description: New user type/role
            example:
              id: 550e8400-e29b-41d4-a716-446655440000
              userType: ADMIN
      responses:
        "200":
          description: User type changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      userType:
                        type: string
                        enum: [ADMIN, MEMBER, OWNER]
              example:
                status: success
                message: User type updated successfully
                user:
                  id: 550e8400-e29b-41d4-a716-446655440000
                  userType: ADMIN
        "400":
          description: Bad request - Invalid input
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden - Insufficient permissions
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                memberCannotChange:
                  value:
                    status: error
                    message: Members cannot change user types
                ownerCannotChangeAdmin:
                  value:
                    status: error
                    message: Owners cannot change Admin user types
                cannotChangeOwnType:
                  value:
                    status: error
                    message: Organization owner cannot change their own userType
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /deleteUser:
    delete:
      summary: Delete user from organization
      description: |
        Deletes a user from the organization.

        **Requires:** JWT Bearer token in Authorization header

        **Deletion Rules:**
        - Cannot delete yourself
        - Cannot delete the organization owner
        - MEMBER cannot delete anyone
        - OWNER cannot delete ADMIN
        - MEMBER cannot delete OWNER or ADMIN
      operationId: deleteUser
      tags:
        - Settings Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
              properties:
                user_id:
                  type: string
                  format: uuid
                  description: ID of the user to delete
            example:
              user_id: 550e8400-e29b-41d4-a716-446655440000
      responses:
        "200":
          description: User deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
              example:
                status: success
                message: User deleted successfully
        "403":
          description: Forbidden - Insufficient permissions or deletion not allowed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                cannotDeleteSelf:
                  value:
                    status: error
                    message: You cannot delete yourself
                cannotDeleteOwner:
                  value:
                    status: error
                    message: The organization owner cannot be deleted
                ownerCannotDeleteAdmin:
                  value:
                    status: error
                    message: Owners cannot delete Admins
        "404":
          description: User not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /deleteAdmin:
    delete:
      summary: Delete own account
      description: |
        Permanently deletes the authenticated user's account and all associated data.

        **Requires:** JWT Bearer token in Authorization header

        **This action will delete:**
        - User's auth account
        - User's profile data
        - User's profile picture (storage and database)
        - User's organization
        - **All members in the user's organization** (their auth, profiles, and profile pictures)

        **Warning:** This action is irreversible and will delete the entire organization!
      operationId: deleteAdmin
      tags:
        - Authentication
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        "200":
          description: Account deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
              example:
                status: success
                message: Account deleted successfully
        "401":
          description: Unauthorized - Invalid or missing JWT token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /markUserAsActive:
    post:
      summary: Mark user as active
      description: |
        Marks an inactive user as active, allowing them to log in again.

        **Authorization Rules:**
        - Only ADMIN and OWNER can mark users as active
        - OWNER cannot mark ADMIN users as active
        - MEMBER cannot mark anyone as active
        - Can only mark users within the same organization
      operationId: markUserAsActive
      tags:
        - Settings Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [userId]
              properties:
                userId:
                  type: string
                  format: uuid
            example:
              userId: 550e8400-e29b-41d4-a716-446655440000
      responses:
        "200":
          description: User marked as active
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /markUserAsInactive:
    post:
      summary: Mark user as inactive
      description: Marks a user inactive, preventing login.
      operationId: markUserAsInactive
      tags:
        - Settings Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [userId]
              properties:
                userId:
                  type: string
                  format: uuid
      responses:
        "200":
          description: User marked as inactive
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /resendInvite:
    post:
      summary: Resend invitation to user
      description: |
        Resends an invitation to a user who has not yet accepted their invite.

        **Mechanism:**
        - Checks if user is in "Invited" or "Expired" state (never logged in).
        - **Deletes** the existing user account (Auth and DB).
        - **Re-creates** the user account with the same email and role.
        - Sends a new password reset (invitation) email.

        **Requires:** ADMIN or OWNER role.
      operationId: resendInvite
      tags:
        - Settings Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_id
              properties:
                user_id:
                  type: string
                  format: uuid
                  description: ID of the user to re-invite
      responses:
        "200":
          description: Invitation resent successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "400":
          description: Bad request (User already active, invalid ID)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden (Insufficient permissions)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
  /getAllOrganizationMembers:
    get:
      summary: Get all organization members
      description: |
        Retrieves complete details of all members in the authenticated user's organization, including the owner.

        **Requires:** JWT Bearer token in Authorization header

        **Returns:**
        - Full user details including profile pictures and industry information
        - `createdBy`: Information about who created each member (id, name, email, profilePicture)
        - `lastActive`: Timestamp of the member's last login
      operationId: getAllOrganizationMembers
      tags:
        - Settings Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        "200":
          description: Organization members fetched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  members:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        fullName:
                          type: string
                        email:
                          type: string
                        phone:
                          type: string
                          nullable: true
                        publisherName:
                          type: string
                          nullable: true
                        userType:
                          type: string
                          enum: [ADMIN, OWNER, MEMBER]
                        role:
                          type: string
                          nullable: true
                        industry:
                          type: object
                          nullable: true
                          properties:
                            id:
                              type: string
                              format: uuid
                            industryName:
                              type: string
                        profilePicture:
                          type: object
                          nullable: true
                          properties:
                            id:
                              type: string
                              format: uuid
                            url:
                              type: string
                        isOwner:
                          type: boolean
                        createdAt:
                          type: string
                          format: date-time
                        createdBy:
                          type: object
                          nullable: true
                          description: Information about the user who created this member
                          properties:
                            id:
                              type: string
                              format: uuid
                            name:
                              type: string
                            email:
                              type: string
                            profilePicture:
                              type: object
                              nullable: true
                              properties:
                                id:
                                  type: string
                                  format: uuid
                                url:
                                  type: string
                        lastActive:
                          type: string
                          format: date-time
                          nullable: true
                          description: Timestamp of the user's last login
                        addedOn:
                          type: string
                          format: date-time
                          nullable: true
                          description: Timestamp when the user was created (from auth table)
                        status:
                          type: string
                          enum: [Active, Invited, Expired, Inactive]
                          description: |
                            User account status:
                            - Invited: User has not logged in yet and invite link is valid (< 1 hour old)
                            - Active: User has logged in at least once
                            - Expired: User has not logged in and invite link has expired (> 1 hour old)
                            - Inactive: User account has been manually deactivated by an admin
                  totalMembers:
                    type: integer
              example:
                status: success
                message: Organization members fetched successfully
                members:
                  - id: e2cad916-38c3-488e-9e11-fb20f0380f16
                    fullName: John Doe
                    email: john@example.com
                    phone: "+1234567890"
                    publisherName: Acme Publishing
                    userType: OWNER
                    role: CEO
                    industry:
                      id: 8ed98054-6dfe-4383-bd35-9a822b8f06c3
                      industryName: Academic Publishing
                    profilePicture:
                      id: abc123
                      url: https://example.com/pic.jpg
                    isOwner: true
                    createdAt: "2026-01-14T00:00:00Z"
                    createdBy:
                      id: e2cad916-38c3-488e-9e11-fb20f0380f16
                      name: John Doe
                      email: john@example.com
                      profilePicture:
                        id: abc123
                        url: https://example.com/pic.jpg
                    lastActive: "2026-01-15T23:14:35Z"
                    addedOn: "2026-01-10T10:30:00Z"
                    status: Active
                  - id: 550e8400-e29b-41d4-a716-446655440000
                    fullName: Jane Smith
                    email: jane@example.com
                    phone: null
                    publisherName: null
                    userType: MEMBER
                    role: Editor
                    industry: null
                    profilePicture: null
                    isOwner: false
                    createdAt: "2026-01-14T00:00:00Z"
                    createdBy:
                      id: e2cad916-38c3-488e-9e11-fb20f0380f16
                      name: John Doe
                      email: john@example.com
                      profilePicture:
                        id: abc123
                        url: https://example.com/pic.jpg
                    lastActive: null
                    addedOn: "2026-01-14T14:22:15Z"
                    status: Invited
                totalMembers: 2
        "404":
          description: Organization not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /getOrganization:
    get:
      summary: Get user's organization
      description: |
        Retrieves the authenticated user's organization details.

        **Requires:** JWT Bearer token in Authorization header
      operationId: getOrganization
      tags:
        - Settings Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        "200":
          description: Organization fetched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  organization:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      ownerId:
                        type: string
                        format: uuid
                      memberIds:
                        type: array
                        items:
                          type: string
                          format: uuid
                      createdAt:
                        type: string
                        format: date-time
                      updatedAt:
                        type: string
                        format: date-time
              example:
                status: success
                message: Organization fetched successfully
                organization:
                  id: 660e8400-e29b-41d4-a716-446655440001
                  ownerId: e2cad916-38c3-488e-9e11-fb20f0380f16
                  memberIds: ["550e8400-e29b-41d4-a716-446655440000"]
                  createdAt: "2026-01-14T00:00:00Z"
                  updatedAt: "2026-01-14T00:00:00Z"
        "404":
          description: Organization not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: User is not part of any organization

  /getOrganizationCopyright:
    post:
      summary: Get organization copyright text
      description: |
        Gets the authenticated user's organization copyright text.

        **Requires:** JWT Bearer token in Authorization header
      tags:
        - Organization Copyright Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                organization_id:
                  type: string
                  format: uuid
              required:
                - organization_id
      responses:
        "200":
          description: Copyrights fetched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Copyrights fetched successfully
                  data:
                    type: object
                    properties:
                      copyrights_text:
                        type: string
                      updated_at:
                        type: string
                        format: date-time
        "403":
          description: Unauthorized
        "404":
          description: Organization or User not found
  /setOrganizationCopyright:
    post:
      summary: Set (Upsert) organization copyright text
      description: |
        Sets (Upserts) the authenticated user's organization copyright text.

        **Requires:** JWT Bearer token in Authorization header
      tags:
        - Organization Copyright Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                organization_id:
                  type: string
                  format: uuid
                copyrights_text:
                  type: string
                  example: " 2026 Example Corporation. All rights reserved. No part of this software, documentation, or related materials may be reproduced, distributed, or transmitted in any form or by any means without prior written permission from Example Corporation."
              required:
                - organization_id
                - copyrights_text
      responses:
        "200":
          description: Copyright created or updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Copyright updated successfully
                  data:
                    type: object
                    properties:
                      copyrights_text:
                        type: string
                      created_at:
                        type: string
                        format: date-time
                      updated_at:
                        type: string
                        format: date-time
        "403":
          description: Unauthorized
        "404":
          description: Organization or User not found
  /addPaymentMethod:
    post:
      summary: Add a new payment method
      description: |
        Adds a new payment method to the organization's Stripe customer and sets it as default.

        **Requires:** ADMIN or OWNER role.
      operationId: addPaymentMethod
      tags:
        - Payment Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - payment_method_id
              properties:
                payment_method_id:
                  type: string
                  description: Stripe Payment Method ID (pm_...)
            example:
              payment_method_id: pm_1234567890abcdefghijklmn
      responses:
        "200":
          description: Payment method added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Payment method added and set as default
                  payment_method:
                    type: object
                    properties:
                      id:
                        type: string
                      type:
                        type: string
                      card:
                        type: object
                        properties:
                          brand:
                            type: string
                          last4:
                            type: string
                          exp_month:
                            type: integer
                          exp_year:
                            type: integer
                      is_default:
                        type: boolean
                  processingTimeMs:
                    type: integer

  /getPaymentMethods:
    post:
      summary: Get all payment methods
      description: |
        Retrieves all payment methods associated with the organization.

        **Requires:** ADMIN or OWNER role.
      operationId: getPaymentMethods
      tags:
        - Payment Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        "200":
          description: Payment methods retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Payment methods fetched successfully
                  payment_methods:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        type:
                          type: string
                        card:
                          type: object
                          properties:
                            brand:
                              type: string
                            last4:
                              type: string
                            exp_month:
                              type: integer
                            exp_year:
                              type: integer
                        is_default:
                          type: boolean
                  processingTimeMs:
                    type: integer

  /setDefaultPaymentMethod:
    post:
      summary: Set default payment method
      description: |
        Sets a specific payment method as the default for the organization.

        **Requires:** ADMIN or OWNER role.
      operationId: setDefaultPaymentMethod
      tags:
        - Payment Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - payment_method_id
              properties:
                payment_method_id:
                  type: string
                  description: Stripe Payment Method ID to set as default
            example:
              payment_method_id: pm_1234567890abcdefghijklmn
      responses:
        "200":
          description: Default payment method updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Default payment method updated successfully
                  payment_method:
                    type: object
                    properties:
                      id:
                        type: string
                      type:
                        type: string
                      card:
                        type: object
                        properties:
                          brand:
                            type: string
                          last4:
                            type: string
                          exp_month:
                            type: integer
                          exp_year:
                            type: integer
                      is_default:
                        type: boolean
                  processingTimeMs:
                    type: integer

  /updatePaymentMethod:
    post:
      summary: Update payment method details
      description: |
        Updates details (expiry, name) of an existing payment method.

        **Requires:** ADMIN or OWNER role.
      operationId: updatePaymentMethod
      tags:
        - Payment Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - payment_method_id
              properties:
                payment_method_id:
                  type: string
                exp_month:
                  type: integer
                exp_year:
                  type: integer
                name:
                  type: string
            example:
              payment_method_id: pm_1234567890abcdefghijklmn
              exp_month: 12
              exp_year: 2026
      responses:
        "200":
          description: Payment method updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Payment method updated successfully
                  payment_method:
                    type: object
                    properties:
                      id:
                        type: string
                      type:
                        type: string
                      card:
                        type: object
                        properties:
                          brand:
                            type: string
                          last4:
                            type: string
                          exp_month:
                            type: integer
                          exp_year:
                            type: integer
                      billing_details:
                        type: object
                        properties:
                          name:
                            type: string
                      is_default:
                        type: boolean
                  processingTimeMs:
                    type: integer

  /deletePaymentMethod:
    post:
      summary: Delete a payment method
      description: |
        Deletes a payment method from the organization.

        **Requires:** ADMIN or OWNER role.
      operationId: deletePaymentMethod
      tags:
        - Payment Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - payment_method_id
              properties:
                payment_method_id:
                  type: string
            example:
              payment_method_id: pm_1234567890abcdefghijklmn
      responses:
        "200":
          description: Payment method deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Payment method deleted successfully
                  processingTimeMs:
                    type: integer

  /getBillingHistory:
    post:
      summary: Get billing history
      description: |
        Retrieves billing history (charges) for the organization.

        **Requires:** ADMIN or OWNER role.
      operationId: getBillingHistory
      tags:
        - Payment Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        "200":
          description: Billing history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  transactions:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        amount:
                          type: number
                        currency:
                          type: string
                        status:
                          type: string
                        description:
                          type: string
                        created:
                          type: string
                          format: date-time
                        receipt_url:
                          type: string
                        payment_method:
                          type: object
                          properties:
                            brand:
                              type: string
                            last4:
                              type: string
                        refunded:
                          type: boolean
                        amount_refunded:
                          type: number
                        price_per_credit:
                          type: number
                          nullable: true
                        total_credits_purchased:
                          type: integer
                          nullable: true
                        total_amount_spent:
                          type: number
                  has_more:
                    type: boolean
                  processingTimeMs:
                    type: integer

  /getCreditAllocation:
    get:
      summary: Get credit allocation
      description: |
        Retrieves the authenticated user's credit balances (available, used, total).

        **Requires:** JWT Bearer token.
      operationId: getCreditAllocation
      tags:
        - Payment Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        "200":
          description: Credit allocation retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Credit allocation fetched successfully
                  allocation:
                    type: object
                    properties:
                      user_id:
                        type: string
                        format: uuid
                      credits_available:
                        type: integer
                      credits_used:
                        type: integer
                      total_credits_used:
                        type: integer
                  processingTimeMs:
                    type: integer

  /chargePaymentMethod:
    post:
      summary: Purchase credits
      description: |
        Charges the organization's default payment method to purchase credits.
        Price is calculated based on `credits_pricing` table.

        **Requires:** ADMIN or OWNER role.
      operationId: chargePaymentMethod
      tags:
        - Payment Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - numberOfCredits
              properties:
                numberOfCredits:
                  type: integer
                  minimum: 1
                  description: Number of credits to purchase
            example:
              numberOfCredits: 100
      responses:
        "200":
          description: Charge successful and credits allocated
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Credits purchased successfully
                  purchase:
                    type: object
                    properties:
                      total_credits_purchased:
                        type: integer
                      total_amount_spent:
                        type: number
                      currency:
                        type: string
                      price_per_credit:
                        type: number
                      transaction_id:
                        type: string
                  processingTimeMs:
                    type: integer

  /getCreditsCost:
    get:
      summary: Get credits pricing
      description: |
        Retrieves the current pricing for credits from the credits_pricing table.

        **Requires:** JWT Bearer token in Authorization header
      operationId: getCreditsCost
      tags:
        - Settings Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        "200":
          description: Credits pricing fetched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  pricing:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      pricePerCredit:
                        type: number
                        format: decimal
                        description: Price per credit in USD
                      createdAt:
                        type: string
                        format: date-time
                      updatedAt:
                        type: string
                        format: date-time
              example:
                status: success
                message: Credits pricing fetched successfully
                pricing:
                  id: 550e8400-e29b-41d4-a716-446655440000
                  pricePerCredit: 0.10
                  createdAt: "2026-01-15T00:00:00Z"
                  updatedAt: "2026-01-15T00:00:00Z"
        "401":
          description: Unauthorized - Invalid or missing JWT token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /getTotalCredits:
    get:
      summary: Get total available credits for usage
      description: |
        Returns the total credits available to the user.
        Credits are shared within an organization, so this returns the organization owner's credit balance.

        **Authentication Required**: This endpoint requires a valid JWT access token in the Authorization header.
      operationId: getTotalCredits
      security:
        - BearerAuth: []
      tags:
        - Resources
      responses:
        "200":
          description: Total credits retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      total_credits:
                        type: integer
                        example: 10000
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /createNewProject:
    post:
      summary: Create a new audiobook project
      description: |
        Creates a new project with book details and file uploads.
        - Uploads cover image and manuscript to storage.
        - Creates entries in `galleries` and `projects` tables.
        - Assigns owner and organization based on authenticated user.
      operationId: createNewProject
      tags:
        - Audiobook Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - title
                - author
                - genre_id
                - description
                - manuscript
              properties:
                title:
                  type: string
                author:
                  type: string
                genre_id:
                  type: string
                  format: uuid
                  description: UUID of the genre
                description:
                  type: string
                isbn:
                  type: string
                publisher_name:
                  type: string
                publication_date:
                  type: string
                  format: date-time
                cover_image:
                  type: string
                  format: binary
                  description: Cover image file (optional)
                manuscript:
                  type: string
                  format: binary
                  description: Manuscript file (mandatory)
      responses:
        "201":
          description: Project created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      project:
                        $ref: "#/components/schemas/Project"
        "400":
          description: Bad Request (Missing fields or invalid input)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /getAllProjects:
    get:
      summary: Get all projects for user
      description: |
        Retrieves all projects where the user is the owner or has implicit access via organization.
      operationId: getAllProjects
      tags:
        - Audiobook Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Page number for pagination
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Number of items per page
      responses:
        "200":
          description: Projects retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Project"
                      meta:
                        type: object
                        properties:
                          total:
                            type: integer
                          page:
                            type: integer
                          limit:
                            type: integer
                          totalPages:
                            type: integer
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /searchProjects:
    get:
      summary: Search and filter projects
      description: |
        Searches and filters projects based on various criteria.
        Supports text search across title, author, and description fields.
        Applies same authorization logic as getAllProjects (owner or access_levels).
      operationId: searchProjects
      tags:
        - Audiobook Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Page number for pagination
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Number of items per page
        - in: query
          name: search
          schema:
            type: string
          description: Search text to match against title, author, or description
          example: "Harry Potter"
        - in: query
          name: genre
          schema:
            type: string
            format: uuid
          description: Filter by genre ID
          example: "550e8400-e29b-41d4-a716-446655440000"
        - in: query
          name: status
          schema:
            type: string
            enum: [Processing, InProgress, Completed]
          description: Filter by project status
          example: "Completed"
        - in: query
          name: duration_min
          schema:
            type: string
          description: Minimum duration (PostgreSQL interval format)
          example: "00:30:00"
        - in: query
          name: duration_max
          schema:
            type: string
          description: Maximum duration (PostgreSQL interval format)
          example: "02:00:00"
      responses:
        "200":
          description: Projects searched successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Project"
                      meta:
                        type: object
                        properties:
                          total:
                            type: integer
                          page:
                            type: integer
                          limit:
                            type: integer
                          totalPages:
                            type: integer
                      filters:
                        type: object
                        properties:
                          search:
                            type: string
                            nullable: true
                          genre:
                            type: string
                            nullable: true
                          status:
                            type: string
                            nullable: true
                          duration_min:
                            type: string
                            nullable: true
                          duration_max:
                            type: string
                            nullable: true
              example:
                status: success
                message: "Projects searched successfully"
                data: []
                meta:
                  total: 0
                  page: 1
                  limit: 10
                  totalPages: 0
                filters:
                  search: "fantasy"
                  genre: "550e8400-e29b-41d4-a716-446655440000"
                  status: "Completed"
                  duration_min: null
                  duration_max: null
        "400":
          description: Bad Request - Invalid status value
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: "Invalid status. Must be one of: Processing, InProgress, Completed"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /getProjectById:
    get:
      summary: Get a specific project by ID
      description: |
        Retrieves a single project's details by its UUID.

        **Requires:**
        - JWT Bearer token
        - User must be the owner of the project OR have access via organization/shared access.
      operationId: getProjectById
      tags:
        - Audiobook Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      parameters:
        - in: query
          name: id
          schema:
            type: string
            format: uuid
          required: true
          description: UUID of the project to retrieve
      responses:
        "200":
          description: Project retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      project:
                        $ref: "#/components/schemas/Project"
        "400":
          description: Bad Request (Missing ID)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Project not found or access denied
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /deleteProjectById:
    delete:
      summary: Delete a project by ID
      description: |
        Deletes a project and all its associated resources including:
        - Studio record
        - Gallery records
        - Files in storage buckets (cover_images and files)

        **Authorization**: Only the project owner can delete the project.
      operationId: deleteProjectById
      tags:
        - Audiobook Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      parameters:
        - in: query
          name: id
          schema:
            type: string
            format: uuid
          required: true
          description: UUID of the project to delete
          example: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        "200":
          description: Project deleted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      deleted:
                        type: object
                        properties:
                          project:
                            type: string
                            format: uuid
                            description: ID of the deleted project
                          studio:
                            type: string
                            format: uuid
                            nullable: true
                            description: ID of the deleted studio
                          galleries:
                            type: array
                            items:
                              type: string
                              format: uuid
                            description: IDs of deleted gallery records
                          files:
                            type: integer
                            description: Number of files deleted from storage
              example:
                status: success
                message: "Project and associated resources deleted successfully"
                deleted:
                  project: "550e8400-e29b-41d4-a716-446655440000"
                  studio: "660e8400-e29b-41d4-a716-446655440001"
                  galleries: ["770e8400-e29b-41d4-a716-446655440002"]
                  files: 3
        "400":
          description: Bad Request - Missing project ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: "Missing required parameter: id"
        "403":
          description: Forbidden - User is not authorized to delete this project
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: "Unauthorized to delete this project"
        "404":
          description: Not Found - Project not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: "Project not found"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /getAllGenres:
    get:
      summary: Get all genres
      description: |
        Retrieves a list of all available book genres.
      operationId: getAllGenres
      tags:
        - Audiobook Management
      security:
        - SupabaseAuth: []
          BearerAuth: []
      responses:
        "200":
          description: Genres retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      genres:
                        type: array
                        items:
                          $ref: "#/components/schemas/Genre"
              example:
                status: success
                message: Genres retrieved successfully
                genres:
                  - id: "unique-uuid-1"
                    genreName: "Fiction"
                  - id: "unique-uuid-2"
                    genreName: "Mystery"
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /getAllVoices:
    get:
      summary: Get all available voices
      description: |
        Retrieves a list of all available ElevenLabs voices stored in the system.
        No authentication is required for this endpoint.
      operationId: getAllVoices
      tags:
        - Resources
      responses:
        "200":
          description: A list of voices
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      voices:
                        type: array
                        items:
                          type: object
                          properties:
                            voice_id:
                              type: string
                              example: "21m00Tcm4TlvDq8ikWAM"
                            name:
                              type: string
                              example: "Rachel"
                            category:
                              type: string
                              example: "premade"
                            preview_url:
                              type: string
                              format: uri
                              example: "https://storage.googleapis.com/eleven-public-prod/premade/voices/21m00Tcm4TlvDq8ikWAM/df6788f9-5c96-470d-8312-a63e8586a635.mp3"
                            description:
                              type: string
                              example: "Calm and soothing voice."
                            labels:
                              type: object
                            fine_tuning:
                              type: object
                            verified_languages:
                              type: array
                              items:
                                type: object

  /getAllIndustries:
    get:
      summary: Get all industries
      description: |
        Retrieves a list of all available industries for book publishing professionals.

        This endpoint is public and does not require authentication.
      operationId: getAllIndustries
      tags:
        - Settings Management
      responses:
        "200":
          description: Industries fetched successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  industries:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          format: uuid
                        industry_name:
                          type: string
              example:
                status: success
                message: Industries fetched successfully
                industries:
                  - id: 550e8400-e29b-41d4-a716-446655440000
                    industry_name: Academic Publishing
                  - id: 660e8400-e29b-41d4-a716-446655440001
                    industry_name: Fiction & Literature

  /getGallery:
    get:
      summary: Get gallery by project or studio ID
      description: |
        Retrieves the full gallery object for a given project_id or studio_id.
        The function checks both the `projects` and `studio` tables for the provided ID,
        then returns the associated gallery.

        **Authentication Required**: This endpoint requires a valid JWT access token in the Authorization header.
      operationId: getGallery
      security:
        - BearerAuth: []
      tags:
        - Resources
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
          description: The project_id (UUID) or studio_id (string) to look up the gallery for
      responses:
        "200":
          description: Gallery retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      gallery:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          name:
                            type: string
                          files:
                            type: array
                            description: Array of file objects in the gallery
        "400":
          description: Bad Request - Missing or invalid id parameter
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Not Found - No gallery found for the provided id
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /uploadFileToGallery:
    post:
      summary: Upload a file to a gallery
      description: |
        Uploads a file to the storage bucket and adds it to a gallery's files array.
        The file type is validated before upload (PDF, audio formats, Word docs, EPUB, text files).

        **Authentication Required**: This endpoint requires a valid JWT access token in the Authorization header.
      operationId: uploadFileToGallery
      security:
        - BearerAuth: []
      tags:
        - Resources
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - gallery_id
                - file
              properties:
                gallery_id:
                  type: string
                  format: uuid
                  description: The UUID of the gallery to upload the file to
                file:
                  type: string
                  format: binary
                  description: The file to upload (PDF, MP3, WAV, AAC, OGG, FLAC, DOC, DOCX, EPUB, TXT, MD)
      responses:
        "200":
          description: File uploaded successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      file:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          url:
                            type: string
        "400":
          description: Bad Request - Missing required fields or unsupported file type
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Not Found - Gallery not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error - Failed to upload file
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /deleteFileFromGallery:
    delete:
      summary: Delete a file from gallery and storage
      description: |
        Deletes a file from both the storage bucket and the gallery JSONB array.
        The function searches all galleries to find the file, deletes it from the `files` bucket,
        and removes it from the gallery's files array.

        **Authentication Required**: This endpoint requires a valid JWT access token in the Authorization header.
      operationId: deleteFileFromGallery
      security:
        - BearerAuth: []
      tags:
        - Resources
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
              properties:
                id:
                  type: string
                  format: uuid
                  description: The UUID of the file to delete
                  example: "38d80a10-2cec-4359-93cf-4319d0d7778b"
      responses:
        "200":
          description: File deleted successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
        "400":
          description: Bad Request - Missing or invalid id parameter
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Not Found - File not found in any gallery
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error - Failed to delete file
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /createComment:
    post:
      summary: Create a new comment on a studio block or chapter
      description: |
        Creates a comment. There are 3 types of comments:
        1. **Chapter Comment**: Provide `chapter_id`. Leave `block_id` empty.
        2. **Block Comment**: Provide `block_id`. Leave `chapter_id` empty.
        3. **Word Comment**: Provide `block_id`, and (`quote` OR `range`). Leave `chapter_id` empty.
      operationId: createComment
      security:
        - BearerAuth: []
      tags:
        - Studio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - studio_id
                - text
              properties:
                studio_id:
                  type: string
                block_id:
                  type: string
                  description: Required for Block and Word comments. Do NOT use for Chapter comments.
                chapter_id:
                  type: string
                  description: Required for Chapter comments. Do NOT use for Block or Word comments.
                text:
                  type: string
                  description: The comment content.
                quote:
                  type: string
                  description: (Word Level/Optional) Selected text. Provide this OR `range`.
                range:
                  type: object
                  description: (Word Level/Optional) Selection range. Provide this OR `quote`.
                  properties:
                    start:
                      type: integer
                    end:
                      type: integer
      responses:
        "201":
          description: Comment created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      comment:
                        $ref: "#/components/schemas/Comment"
        "400":
          description: Bad Request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /deleteComment:
    delete:
      summary: Delete a comment from a studio block
      description: |
        Deletes a comment from a studio block. Only the user who created the comment can delete it.
      operationId: deleteComment
      security:
        - BearerAuth: []
      tags:
        - Studio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - studio_id
                - comment_id
              properties:
                studio_id:
                  type: string
                comment_id:
                  type: string
      responses:
        "200":
          description: Comment deleted successfully
        "404":
          description: Comment not found

  /deleteChapter:
    delete:
      summary: Delete a chapter
      description: Deletes a chapter from Supabase and ElevenLabs.
      operationId: deleteChapter
      security:
        - BearerAuth: []
      tags:
        - Studio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - studio_id
                - chapter_id
              properties:
                studio_id:
                  type: string
                  description: ElevenLabs Project ID
                chapter_id:
                  type: string
            example:
              studio_id: "06bede21-9694-4a32-88f5-e966cfa13f4"
              chapter_id: "0C8UHtgU0v0L9ViLmFpr"
      responses:
        "200":
          description: Chapter deleted successfully
        "502":
          description: Failed to delete from ElevenLabs

  /renameChapter:
    post:
      summary: Rename a chapter
      description: Renames a chapter in Supabase (and attempts ElevenLabs update).
      operationId: renameChapter
      security:
        - BearerAuth: []
      tags:
        - Studio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - studio_id
                - chapter_id
                - chapter_name
              properties:
                studio_id:
                  type: string
                chapter_id:
                  type: string
                chapter_name:
                  type: string
            example:
              studio_id: "06bede21-9694-4a32-88f5-e966cfa13f4"
              chapter_id: "0C8UHtgU0v0L9ViLmFpr"
              chapter_name: "New Chapter Name"
      responses:
        "200":
          description: Chapter renamed successfully

  /duplicateChapter:
    post:
      summary: Duplicate a chapter
      description: Creates a copy of a chapter and inserts it immediately after the original.
      operationId: duplicateChapter
      security:
        - BearerAuth: []
      tags:
        - Studio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - studio_id
                - chapter_id
              properties:
                studio_id:
                  type: string
                chapter_id:
                  type: string
            example:
              studio_id: "06bede21-9694-4a32-88f5-e966cfa13f4"
              chapter_id: "0C8UHtgU0v0L9ViLmFpr"
      responses:
        "200":
          description: Chapter duplicated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  message:
                    type: string
                  chapter:
                    $ref: "#/components/schemas/StudioChapter"

  /addCastMember:
    post:
      summary: Add a new cast member
      description: Adds a cast member, optionally remixing voice settings and replacing global overrides.
      operationId: addCastMember
      security:
        - BearerAuth: []
      tags:
        - Studio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - studio_id
                - nickname
                - voice_id
                - override_globally
              properties:
                studio_id:
                  type: string
                nickname:
                  type: string
                voice_id:
                  type: string
                override_globally:
                  type: boolean
                override_settings:
                  type: object
                  properties:
                    speaking_rate:
                      type: number
                    performance_intensity:
                      type: number
                    expressiveness:
                      type: number
                    "voice fidelity":
                      type: number
                    "enhance voice character":
                      type: boolean
      responses:
        "200":
          description: Cast member added successfully

  /editCastMember:
    post:
      summary: Edit a cast member
      description: Updates cast member details and settings.
      operationId: editCastMember
      security:
        - BearerAuth: []
      tags:
        - Studio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - studio_id
                - cast_id
              properties:
                studio_id:
                  type: string
                cast_id:
                  type: string
                nickname:
                  type: string
                voice_id:
                  type: string
                override_globally:
                  type: boolean
                override_settings:
                  type: object
                  properties:
                    speaking_rate:
                      type: number
                    performance_intensity:
                      type: number
                    expressiveness:
                      type: number
                    "voice fidelity":
                      type: number
                    "enhance voice character":
                      type: boolean
      responses:
        "200":
          description: Cast member updated successfully

  /deleteCastMember:
    delete:
      summary: Delete a cast member
      description: Deletes cast member and reverts voice substitution in chapters.
      operationId: deleteCastMember
      security:
        - BearerAuth: []
      tags:
        - Studio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - studio_id
                - cast_id
              properties:
                studio_id:
                  type: string
                cast_id:
                  type: string
      responses:
        "200":
          description: Cast member deleted successfully


                commentNotFound:
                  value:
                    status: error
                    message: Comment not found

  /editComment:
    put:
      summary: Edit a comment on a studio block
      description: |
        Updates the text of an existing comment. Only the user who created the comment can edit it.
        The timestamp will be updated to reflect when the comment was edited.
      operationId: editComment
      security:
        - BearerAuth: []
      tags:
        - Studio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - studio_id
                - comment_id
                - text
              properties:
                studio_id:
                  type: string
                  description: The ID of the studio containing the comment
                  example: "4VjB54RZqdmqRjxXrAZl"
                comment_id:
                  type: string
                  format: uuid
                  description: The UUID of the comment to edit
                  example: "550e8400-e29b-41d4-a716-446655440000"
                text:
                  type: string
                  description: The new comment text
                  example: "This is my updated comment"
      responses:
        "200":
          description: Comment updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      comment:
                        $ref: "#/components/schemas/Comment"
              example:
                status: success
                message: Comment updated successfully
                comment:
                  id: "550e8400-e29b-41d4-a716-446655440000"
                  user_id: "3d3f30cf-2e27-4f71-8469-4adfba9b5578"
                  user_name: "John Doe"
                  text: "This is my updated comment"
                  timestamp: "2026-02-04T03:16:00Z"
                  block_id: "vSoEd0ch3yD4gd1usdJZ"
                  resolved: false
        "400":
          description: Bad Request - Missing fields or empty text
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                missingFields:
                  value:
                    status: error
                    message: "Missing required fields: studio_id, comment_id, text"
                emptyText:
                  value:
                    status: error
                    message: "Comment text cannot be empty"
        "403":
          description: Forbidden - User is not authorized to edit this comment
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: Unauthorized to edit this comment
        "404":
          description: Not Found - Studio or comment not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                studioNotFound:
                  value:
                    status: error
                    message: Studio not found
                commentNotFound:
                  value:
                    status: error
                    message: Comment not found

  /getAllComments:
    get:
      summary: Get comments for a studio, chapter, or block
      description: |
        Retrieves comments. Supports filtering by:
        - `studio_id` (Required): Get all comments for the studio.
        - `chapter_id` (Optional): Get all comments for a specific chapter.
        - `block_id` (Optional): Get all comments for a specific block.
      operationId: getAllComments
      security:
        - BearerAuth: []
      tags:
        - Studio
      parameters:
        - name: studio_id
          in: query
          required: true
          schema:
            type: string
        - name: block_id
          in: query
          required: false
          schema:
            type: string
        - name: chapter_id
          in: query
          required: false
          schema:
            type: string
      responses:
        "200":
          description: Comments retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      comments:
                        type: array
                        items:
                          $ref: "#/components/schemas/Comment"
                      count:
                        type: integer
        "404":
          description: Studio not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /getComment:
    get:
      summary: Get a specific comment by ID
      operationId: getComment
      security:
        - BearerAuth: []
      tags:
        - Studio
      parameters:
        - name: studio_id
          in: query
          required: true
          schema:
            type: string
        - name: comment_id
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Comment retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      comment:
                        $ref: "#/components/schemas/Comment"
        "404":
          description: Comment or studio not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /toggleCommentResolution:
    post:
      summary: Toggle the resolved status of a comment
      description: |
        Toggles the resolved status of a comment between true and false.

        **Authentication Required**: This endpoint requires a valid JWT access token in the Authorization header.
      operationId: toggleCommentResolution
      security:
        - BearerAuth: []
      tags:
        - Studio
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - studio_id
                - comment_id
              properties:
                studio_id:
                  type: string
                  description: The ID of the studio
                comment_id:
                  type: string
                  format: uuid
                  description: The ID of the comment to toggle
      responses:
        "200":
          description: Comment resolution toggled successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      comment:
                        $ref: "#/components/schemas/Comment"
        "400":
          description: Bad Request - Missing required fields
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Comment or studio not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /flushDatabase:
    post:
      summary: Flush entire database (ADMIN ONLY)
      description: |
        **DANGER: This permanently deletes ALL data from the database.**

        Requires admin password. Deletes all entries from:
        - auth.users (Supabase Auth)
        - users table
        - organizations table
        - copyrights table
        - profile_pictures table and storage bucket
        - industries table

        **Does NOT delete:** credits_pricing table
      operationId: flushDatabase
      tags:
        - Backend ADMIN Controls
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  format: password
                  description: Admin password to authorize flush operation
            example:
              password: "your-admin-password"
      responses:
        "200":
          description: Database flushed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SuccessResponse"
              example:
                status: success
                message: Database flushed successfully
        "403":
          description: Invalid admin password
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              example:
                status: error
                message: Invalid admin password
        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /getStudio:
    get:
      summary: Get studio data for a project
      description: |
        Retrieves studio information including book details, chapters, and gallery ID.
        Requires authenticated user with access to the project.
      operationId: getStudio
      tags:
        - Audiobook Management
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: projectId
          schema:
            type: string
            format: uuid
          required: true
          description: The ID of the project
      responses:
        "200":
          description: Studio retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      studio:
                        $ref: "#/components/schemas/GetStudioResponse"
        "400":
          description: Missing project ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Project or Studio not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /getChapterDetails:
    get:
      summary: Get chapter details (stats)
      description: |
        Retrieves statistics for all chapters in a project, including title, word count, and estimated credits used.
        Requires authenticated user with access to the project.
      operationId: getChapterDetails
      tags:
        - Audiobook Management
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: projectId
          schema:
            type: string
            format: uuid
          required: true
          description: The ID of the project
      responses:
        "200":
          description: Chapter details retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/ChapterDetails"
        "400":
          description: Missing project ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /getAllChapters:
    get:
      summary: Get all chapters or a single chapter
      description: |
        Retrieves chapters for a project.
        If chapterId is provided, returns that specific chapter in the chapters array.
        Includes word count and credits usage.
        Requires authenticated user with access to the project.
      operationId: getAllChapters
      tags:
        - Audiobook Management
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: projectId
          schema:
            type: string
            format: uuid
          required: true
          description: The ID of the project
        - in: query
          name: chapterId
          schema:
            type: string
          required: false
          description: Optional ID of a specific chapter
      responses:
        "200":
          description: Chapters retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      chapters:
                        type: array
                        items:
                          $ref: "#/components/schemas/ChapterSummary"
        "400":
          description: Missing project ID
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Project or Studio not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /editChapter:
    post:
      summary: Edit a chapter
      description: |
        Updates the content of a specific chapter by calling ElevenLabs API and syncing with local database.
        Requires authenticated user with access to the project.
      operationId: editChapter
      tags:
        - Audiobook Management
      security:
        - BearerAuth: []
        - ElevenLabsAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - projectId
                - chapterId
                - content
              properties:
                projectId:
                  type: string
                  format: uuid
                  description: The ID of the project
                chapterId:
                  type: string
                  description: The ID of the chapter to edit
                content:
                  type: object
                  description: |
                    The content to update (blocks, nodes).
                    For new blocks, `block_id` is not required.
                    `sub_type` is optional but must be one of: p, h1, h2, h3.
                  example:
                    blocks:
                      - nodes:
                          - type: "tts_node"
                            text: ""
                            voice_id: ""
                        block_id: "" # not required for new blocks but for existing blocks
                        sub_type: "" # not compulsory but an enum
      responses:
        "200":
          description: Chapter updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      chapter:
                        $ref: "#/components/schemas/Chapter"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /generateAudioForChapter:
    post:
      summary: Generate audio for a chapter
      description: |
        Triggers audio generation for a chapter using ElevenLabs and streams the result.
        Process:
        1. Converts chapter (creates snapshot)
        2. Retrieves latest snapshot
        3. Streams the audio back to client
        4. (Server-side) Saves the generated audio and uploads it to the project's gallery if a gallery_id is associated with the project.

        Requires authenticated user with access to the project.
      operationId: generateAudioForChapter
      tags:
        - Audiobook Management
      security:
        - BearerAuth: []
        - ElevenLabsAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - projectId
                - chapterId
                - chapterSnapshotId
              properties:
                projectId:
                  type: string
                  format: uuid
                  description: The ID of the project
                chapterId:
                  type: string
                  description: The ID of the chapter to generate audio for
                chapterSnapshotId:
                  type: string
                  description: The ID of the chapter snapshot to stream
      responses:
        "200":
          description: Audio stream
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [success]
                  message:
                    type: string
                  project_id:
                    type: string
                    format: uuid
                  chapter_id:
                    type: string
                  credits_used:
                    type: integer
                    description: The number of credits deducted for this generation
                  file:
                    type: object
                    properties:
                      id:
                        type: string
                        format: uuid
                      url:
                        type: string
                        format: uri
              example:
                status: success
                message: Audio generated successfully
                project_id: 550e8400-e29b-41d4-a716-446655440000
                chapter_id: chapter_123
                credits_used: 2
                file:
                  id: 3fa85f64-5717-4562-b3fc-2c963f66afa6
                  url: https://example.com/audio.mp3
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /getChapterSnapshots:
    get:
      summary: Get snapshots for a chapter
      description: |
        Retrieves snapshots for a specific chapter from ElevenLabs.

        Requires authenticated user with access to the project.
      operationId: getChapterSnapshots
      tags:
        - Audiobook Management
      security:
        - BearerAuth: []
        - ElevenLabsAuth: []
      parameters:
        - in: query
          name: project_id
          schema:
            type: string
            format: uuid
          required: true
          description: The ID of the project
        - in: query
          name: chapter_id
          schema:
            type: string
          required: true
          description: The ID of the chapter
      responses:
        "200":
          description: List of snapshots
          content:
            application/json:
              schema:
                type: object
                properties:
                  snapshots:
                    type: array
                    items:
                      type: object
                      properties:
                        chapter_snapshot_id:
                          type: string
                        studio_id:
                          type: string
                        chapter_id:
                          type: string
                        created_at_unix:
                          type: integer
                        created_at:
                          type: string
                        name:
                          type: string
                  message:
                    type: string
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /getProjectSnapshots:
    get:
      summary: Get snapshots for a project
      description: |
        Retrieves snapshots for a specific project from ElevenLabs.

        Requires authenticated user with access to the project.
      operationId: getProjectSnapshots
      tags:
        - Audiobook Management
      security:
        - BearerAuth: []
        - ElevenLabsAuth: []
      parameters:
        - in: query
          name: project_id
          schema:
            type: string
            format: uuid
          required: true
          description: The ID of the project
      responses:
        "200":
          description: List of snapshots
          content:
            application/json:
              schema:
                type: object
                properties:
                  snapshots:
                    type: array
                    items:
                      type: object
                      properties:
                        project_snapshot_id:
                          type: string
                        studio_id:
                          type: string
                        created_at_unix:
                          type: integer
                        created_at:
                          type: string
                        name:
                          type: string
                  message:
                    type: string
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /convertProject:
    post:
      summary: Convert a project and get latest snapshot
      description: |
        Triggers a conversion for the project in ElevenLabs and returns the latest snapshot.

        Requires `project_id` as multipart/form-data.

        **Note:** This endpoint waits for 10 seconds before fetching the snapshot.
      operationId: convertProject
      tags:
        - Audiobook Management
      security:
        - BearerAuth: []
        - ElevenLabsAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                project_id:
                  type: string
                  format: uuid
                  description: The ID of the project to convert
              required:
                - project_id
      responses:
        "200":
          description: Project snapshot retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      project_snapshot_id:
                        type: string
                      studio_id:
                        type: string
                        description: The ElevenLabs project ID
                      created_at_unix:
                        type: integer
                      created_at:
                        type: string
                      name:
                        type: string
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /generateAudioForProject:
    post:
      summary: Generate audio for the entire project
      description: |
        Generates audio for all chapters in a project using ElevenLabs.

        Calculates credit cost based on total character count across all chapters.
        Deducts credits from user's balance.
        Saves the generated audio to Supabase Storage and updates the gallery.

        Requires `project_id` and `project_snapshot_id` as multipart/form-data.
      operationId: generateAudioForProject
      tags:
        - Audiobook Management
      security:
        - BearerAuth: []
        - ElevenLabsAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                project_id:
                  type: string
                  format: uuid
                  description: The ID of the project
                project_snapshot_id:
                  type: string
                  description: The snapshot ID from ElevenLabs to generate audio for
              required:
                - project_id
                - project_snapshot_id
      responses:
        "200":
          description: Audio generated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      project_id:
                        type: string
                        format: uuid
                      credits_used:
                        type: integer
                      file:
                        type: object
                        properties:
                          id:
                            type: string
                            format: uuid
                          url:
                            type: string
                            format: uri
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "402":
          description: Payment Required - Insufficient credits
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /deleteChapter:
    delete:
      summary: Delete a chapter
      description: |
        Deletes a chapter by calling ElevenLabs API and removing it from the local database.
        Also removes associated comments.
        Requires authentication and ElevenLabs API key.
      operationId: deleteChapter
      tags:
        - Audiobook Management
      security:
        - BearerAuth: []
        - ElevenLabsAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                projectId:
                  type: string
                  format: uuid
                  description: The ID of the project.
                chapterId:
                  type: string
                  description: The ID of the chapter to delete.
              required:
                - projectId
                - chapterId
      responses:
        "200":
          description: Chapter deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: success
                  message:
                    type: string
                    example: Chapter deleted successfully
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /renameChapter:
    post:
      summary: Rename a chapter
      description: |
        Renames a chapter by calling ElevenLabs API and updating the local database.
        Requires authenticated user with access to the project.
      operationId: renameChapter
      tags:
        - Audiobook Management
      security:
        - BearerAuth: []
        - ElevenLabsAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - projectId
                - chapterId
                - newName
              properties:
                projectId:
                  type: string
                  format: uuid
                  description: The ID of the project
                chapterId:
                  type: string
                  description: The ID of the chapter to rename
                newName:
                  type: string
                  description: The new name for the chapter
      responses:
        "200":
          description: Chapter renamed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          chapterId:
                            type: string
                          newName:
                            type: string
        "400":
          description: Missing parameters or headers
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Project or Chapter not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error or ElevenLabs API failure
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "502":
          description: Bad Gateway (ElevenLabs API Error)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /convertChapter:
    post:
      summary: Convert a chapter
      description: |
        Triggers chapter conversion via ElevenLabs API.
        Requires authenticated user with access to the project.
      operationId: convertChapter
      tags:
        - Audiobook Management
      security:
        - BearerAuth: []
        - ElevenLabsAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - projectId
                - chapterId
              properties:
                projectId:
                  type: string
                  format: uuid
                  description: The ID of the project
                chapterId:
                  type: string
                  description: The ID of the chapter to convert
      responses:
        "200":
          description: Chapter conversion completed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/SuccessResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          chapter_snapshot_id:
                            type: string
                          project_id:
                            type: string
                          chapter_id:
                            type: string
                          created_at:
                            type: string
                            format: date-time
                            description: ISO 8601 formatted timestamp
                          name:
                            type: string
        "400":
          description: Missing parameters or headers
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: Project or Studio not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "500":
          description: Internal server error or ElevenLabs API failure
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

tags:
  - name: Authentication
    description: User authentication and account management endpoints
  - name: Settings Management
    description: User profile and settings management endpoints
  - name: Multi-Factor Authentication
    description: 2FA enrollment and verification endpoints
  - name: Payment Management
    description: Payment methods and billing history management endpoints
  - name: Backend ADMIN Controls
    description: Administrative endpoints for backend management (DANGEROUS - requires admin password)
  - name: Organization Copyright Management
    description: Organization Copyright management endpoints
  - name: Audiobook Management
    description: APIs for managing audiobook project data (genres, etc.)
  - name: WebSockets
    description: Real-time WebSocket endpoints for long-running processes
